# ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Custom Model ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö RKNN (‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å & ‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô)

> **‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô SDK:** RKNN-Toolkit2 v2.3.0  
> **‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:** November 26, 2025  
> **‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Opset:** ONNX 12-19, PyTorch >=1.6.0

‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **"‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà"** ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Custom Model AI (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Layer ‡πÄ‡∏≠‡∏á, ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Architecture ‡πÄ‡∏≠‡∏á) ‡πÅ‡∏ï‡πà‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ô‡∏≥‡πÑ‡∏õ‡∏£‡∏±‡∏ô‡∏ö‡∏ô‡∏ä‡∏¥‡∏õ NPU (Rockchip RK3588) ‡∏ú‡πà‡∏≤‡∏ô RKNN ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ

## üí° ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: "‡∏õ‡∏£‡∏∏‡∏á‡∏ï‡∏≤‡∏°‡πÉ‡∏à‡∏â‡∏±‡∏ô ‡πÅ‡∏ï‡πà‡∏à‡∏±‡∏î‡∏à‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡πÉ‡∏à NPU"

‡πÉ‡∏´‡πâ‡∏à‡∏≥‡∏Å‡∏é‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏Ñ‡∏£‡∏±‡∏ö:
> **"‡∏ï‡∏≠‡∏ô‡πÄ‡∏ó‡∏£‡∏ô (Training):"** ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏û‡∏¥‡∏™‡∏î‡∏≤‡∏£‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏Å‡πá‡πÑ‡∏î‡πâ
> **"‡∏ï‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å (Export):"** ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (ONNX) ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡πÄ‡∏´‡∏•‡πá‡∏Å 4 ‡∏Ç‡πâ‡∏≠‡∏Ç‡∏≠‡∏á RKNN

‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Å‡∏é 4 ‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡πÑ‡∏™‡πâ‡πÉ‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á ‡∏°‡∏±‡∏ô‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö

---

## üîç ‡∏Å‡∏é‡πÄ‡∏´‡∏•‡πá‡∏Å 4 ‡∏Ç‡πâ‡∏≠ (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏à‡∏≤‡∏Å Official SDK)

**‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å:** `rknn-toolkit2-2.3.0` ‡πÅ‡∏•‡∏∞ `rknn-toolkit2-2.3.2` Official SDK  
**‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß:** ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ONNX YOLOv5, PyTorch ResNet18, ‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ OP Support

‡∏ú‡∏°‡πÑ‡∏î‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å SDK ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

### 1. ‡∏ï‡πâ‡∏≠‡∏á "‡∏ï‡∏±‡∏î‡∏´‡∏±‡∏ß" (Cut the Head / Remove Post-processing)

**‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:** Custom Model ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì **‡∏´‡πâ‡∏≤‡∏°** ‡πÉ‡∏™‡πà‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏û‡∏¥‡∏Å‡∏±‡∏î (Decode Box) ‡πÅ‡∏•‡∏∞ **‡∏´‡πâ‡∏≤‡∏°** ‡πÉ‡∏™‡πà NMS (Non-Maximum Suppression) ‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÇ‡∏°‡πÄ‡∏î‡∏• ‡πÉ‡∏´‡πâ‡∏à‡∏ö‡πÅ‡∏Ñ‡πà Layer ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏û‡πà‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏î‡∏¥‡∏ö‡πÜ (Feature Map) ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤

**‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (‡∏£‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á?):**
‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå: `RKNN-tools/rknn-toolkit2-v2.3.0-2024-11-08/rknn-toolkit2/examples/onnx/yolov5/test.py`
(‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Official ‡∏Ç‡∏≠‡∏á Rockchip)

‡∏î‡∏π‡πÇ‡∏Ñ‡πâ‡∏î‡∏ä‡πà‡∏ß‡∏á‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 138-165:
```python
# ...
# Inference (‡∏£‡∏±‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ö‡∏ô NPU)
outputs = rknn.inference(inputs=[img2], data_format=['nhwc'])

# ... (‡∏Ç‡πâ‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô save file) ...

# Post process (‡πÄ‡∏≠‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏°‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢ Python ‡∏ö‡∏ô CPU)
input0_data = outputs[0]
input1_data = outputs[1]
input2_data = outputs[2]

# ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏≠‡∏á!
boxes, classes, scores = yolov5_post_process(input_data)
```

**‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:**
*   ‡∏ñ‡πâ‡∏≤‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ô‡∏µ‡πâ "‡∏°‡∏µ‡∏´‡∏±‡∏ß" (‡∏£‡∏ß‡∏° Post-processing ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß) ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå `outputs` ‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á `[x, y, w, h, class]` ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏•‡∏¢
*   ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ `outputs` ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô 3 ‡∏Å‡πâ‡∏≠‡∏ô (Raw Data) ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `yolov5_post_process` (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 165) ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Python ‡∏•‡πâ‡∏ß‡∏ô‡πÜ
*   **‡∏™‡∏£‡∏∏‡∏õ:** NPU ‡πÄ‡∏Å‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏π‡∏ì‡πÄ‡∏•‡∏Ç (Convolution) ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏£‡∏£‡∏Å‡∏∞ (Logic if/else ‡πÉ‡∏ô NMS) ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô **‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏ó‡∏≥‡∏ö‡∏ô CPU**

---

### 2. ‡∏ï‡πâ‡∏≠‡∏á "Static Shape" (‡∏Ç‡∏ô‡∏≤‡∏î‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏¥‡πà‡∏á)

**‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:** ‡∏ï‡∏≠‡∏ô Export ONNX **‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ dynamic_axes** ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô `(1, 3, 640, 640)` ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤

**‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (‡∏£‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á?):**
‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå: `test.py` (‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°)

‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 21 ‡πÅ‡∏•‡∏∞ 134:
```python
IMG_SIZE = 640
# ...
img = cv2.resize(img, (IMG_SIZE, IMG_SIZE)) # ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏¢‡πà‡∏≠‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ NPU
```

**‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:**
*   ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö Resize ‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô 640x640 ‡πÄ‡∏õ‡πä‡∏∞‡πÜ ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏°‡πÄ‡∏î‡∏• ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ï‡∏≤‡∏°
*   **‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ:** NPU ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô CPU/GPU ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏°‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á "‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ" (Memory Allocation) ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡πä‡∏∞‡πÜ ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏ñ (‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û) ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏°‡∏≤ ‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏à‡∏≠‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏≠‡∏á‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÑ‡∏ß‡πâ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏°‡∏≤‡∏Å

---

### 3. ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ "Opset 12-19" (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ 12)

**‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:** ‡∏ï‡∏≠‡∏ô Export ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏ `opset_version=12` (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥) ‡∏´‡∏£‡∏∑‡∏≠ 13-19 (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö)

**‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (‡∏£‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á?):**
‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å `CHANGELOG.md` (v1.6.0):  
**"Support ONNX model of OPSET 12~19"**

‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å `RKNNToolKit2_OP_Support-2.3.2.md`:  
**"According to ONNX official instructions, the corresponding ONNX opset version is 19."**

**‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:**
*   SDK ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö **Opset 12-19 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£** (‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà v1.6.0)
*   Opset 12 ‡∏Ñ‡∏∑‡∏≠ **"Sweet Spot"** - ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ‡∏°‡∏µ Operator ‡∏Ñ‡∏£‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
*   Opset 13-19 ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ Operator ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà NPU Compiler ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà optimize ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà

---

### 4. ‡∏£‡∏∞‡∏ß‡∏±‡∏á "5D Tensor" (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 5 ‡∏°‡∏¥‡∏ï‡∏¥)

**‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:** ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÉ‡∏´‡πâ Output ‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÄ‡∏õ‡πá‡∏ô 4 ‡∏°‡∏¥‡∏ï‡∏¥ (NCHW) ‡∏´‡∏£‡∏∑‡∏≠ 3 ‡∏°‡∏¥‡∏ï‡∏¥ ‡∏≠‡∏¢‡πà‡∏≤ Reshape ‡πÄ‡∏õ‡πá‡∏ô 5 ‡∏°‡∏¥‡∏ï‡∏¥‡πÉ‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏•

**‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (‡∏£‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á?):**
‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå: `test.py` (‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°)

‡∏î‡∏π‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 148-156:
```python
input0_data = input0_data.reshape([3, -1]+list(input0_data.shape[-2:]))
# ...
input_data.append(np.transpose(input0_data, (2, 3, 0, 1)))
```

**‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:**
*   ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ `reshape` ‡πÅ‡∏•‡∏∞ `transpose` (‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏Å‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏á **‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å** ‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å NPU ‡πÅ‡∏•‡πâ‡∏ß
*   ‡∏ô‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤ NPU ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà "‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏•‡∏Å‡πÜ" (Hardware Specific Format)
*   ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡πÉ‡∏™‡πà Layer ‡∏û‡∏ß‡∏Å `Reshape` ‡∏´‡∏£‡∏∑‡∏≠ `Permute` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏™‡∏ß‡∏¢‡πÜ ‡πÄ‡∏•‡∏¢ **NPU ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ä‡∏≠‡∏ö** ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ä‡πâ‡∏≤‡∏•‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‡πÄ‡∏Ç‡∏≤‡πÄ‡∏•‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡∏ó‡∏≥‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢ Python ‡πÅ‡∏ó‡∏ô

---

## üìù ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Export Script (‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)

‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Custom Model ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Script ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Export ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡∏â‡∏•‡∏∏‡∏¢

```python
import torch
import torch.nn as nn

# ---------------------------------------------------------
# ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ Custom Model ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
# ---------------------------------------------------------
class MyCustomModel(nn.Module):
    def __init__(self):
        super().__init__()
        # ... ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® Layer ‡∏ï‡πà‡∏≤‡∏á‡πÜ ...
        self.backbone = ... 
        self.head = nn.Conv2d(..., ..., kernel_size=1) 

    def forward(self, x):
        x = self.backbone(x)
        x = self.head(x)
        
        # ‚úÖ ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç 1: "‡∏ï‡∏±‡∏î‡∏´‡∏±‡∏ß"
        # ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ x (Feature Map) ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ 
        # ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏û‡∏¥‡∏Å‡∏±‡∏î ‡∏´‡∏£‡∏∑‡∏≠ NMS
        return x 

# ---------------------------------------------------------
# ‡∏™‡πà‡∏ß‡∏ô Export (The Golden Script)
# ---------------------------------------------------------
def export_to_rknn_ready_onnx():
    # 1. ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•
    model = MyCustomModel()
    model.eval()

    # ‚úÖ ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç 2: "Static Shape"
    # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏¢‡∏ï‡∏±‡∏ß (‡πÄ‡∏ä‡πà‡∏ô 640) ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
    dummy_input = torch.randn(1, 3, 640, 640)

    print("Exporting to ONNX...")
    torch.onnx.export(
        model,
        dummy_input,
        "custom_model_rknn_ready.onnx",
        
        # ‚úÖ ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç 3: "Opset 12"
        opset_version=12,
        
        # ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
        input_names=['images'],
        output_names=['output_feature_map'],
        
        # ‚úÖ ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç 4: ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ dynamic_axes (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Static)
        # dynamic_axes={'images': {0: 'batch_size'}} <--- ‡∏≠‡∏¢‡πà‡∏≤‡∏´‡∏≤‡∏ó‡∏≥! ‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
        
        # ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ NPU ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
        do_constant_folding=True
    )
    
    print("‚úÖ Export ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ RKNN Toolkit ‡πÅ‡∏•‡πâ‡∏ß")

if __name__ == "__main__":
    export_to_rknn_ready_onnx()
```

## ‡∏™‡∏£‡∏∏‡∏õ

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Custom Model ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡∏ö‡∏ô RKNN ‡πÑ‡∏î‡πâ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏¢‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏• ‡πÅ‡∏ï‡πà‡∏¢‡∏≤‡∏Å‡∏ó‡∏µ‡πà **"‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å"** ‡∏Ñ‡∏£‡∏±‡∏ö

1.  **Design:** ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Layer ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (Conv, ReLU, MaxPool) ‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà
2.  **Export:** ‡πÉ‡∏ä‡πâ Script ‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô (Static Shape, Opset 12, No Head)
3.  **Convert:** ‡πÉ‡∏ä‡πâ `rknn-toolkit2` ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå ONNX ‡∏ô‡∏±‡πâ‡∏ô

‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏ô‡∏∏‡∏Å‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Custom Model ‡∏Ñ‡∏£‡∏±‡∏ö! üöÄ